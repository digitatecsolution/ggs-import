<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>GGS Global Consult ‚Äî Admin Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Playfair+Display:wght@400;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --ink:#08090C;--ink2:#0C0D11;--surface:#111318;
  --card:#161820;--card2:#1C1E28;
  --gold-deep:#9A6B0A;--gold:#C8891A;--gold-mid:#E09E28;--gold-bright:#F5B945;
  --teal:#0B6E5C;--teal-mid:#0D8A72;--teal-bright:#12B896;
  --red:#DC2626;--white:#F0EDE7;--muted:#5C5968;--muted2:#8C8898;
  --sidebar-w:260px;--topbar-h:64px;
  --radius:12px;--radius-sm:8px;
  --transition:0.22s cubic-bezier(.4,0,.2,1);
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--ink);color:var(--white);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;line-height:1.5;}

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--muted);border-radius:3px;}

/* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
#auth-screen{position:fixed;inset:0;z-index:9999;background:radial-gradient(ellipse at 30% 40%,#0D8A7220 0%,transparent 60%),var(--ink);display:flex;align-items:center;justify-content:center;}
.auth-card{background:var(--card);border:1px solid #ffffff12;border-radius:20px;padding:48px 40px;width:100%;max-width:420px;box-shadow:0 24px 80px #00000080;}
.auth-logo{text-align:center;margin-bottom:32px;}
.auth-logo h1{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold-bright);letter-spacing:1px;}
.auth-logo p{color:var(--muted2);font-size:13px;margin-top:4px;}
.auth-card label{display:block;font-size:12px;font-weight:600;color:var(--muted2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px;}
.auth-card input{width:100%;background:var(--ink2);border:1px solid #ffffff14;border-radius:var(--radius-sm);padding:12px 14px;color:var(--white);font-family:inherit;font-size:14px;outline:none;transition:border-color var(--transition);}
.auth-card input:focus{border-color:var(--teal-bright);}
.auth-group{margin-bottom:20px;}
.btn-auth{width:100%;padding:13px;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,var(--teal),var(--teal-mid));color:#fff;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;transition:opacity var(--transition);}
.btn-auth:hover{opacity:.85;}
#auth-error{color:var(--red);font-size:13px;text-align:center;margin-top:12px;min-height:20px;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
#app{display:none;height:100vh;overflow:hidden;}
#app.visible{display:flex;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
#sidebar{width:var(--sidebar-w);min-width:var(--sidebar-w);background:var(--ink2);border-right:1px solid #ffffff0a;display:flex;flex-direction:column;height:100vh;overflow:hidden;transition:transform var(--transition),width var(--transition);z-index:200;position:relative;}
.sidebar-header{padding:20px 20px 16px;border-bottom:1px solid #ffffff08;flex-shrink:0;}
.sidebar-logo{font-family:'Playfair Display',serif;font-size:18px;color:var(--gold-bright);letter-spacing:.5px;}
.sidebar-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.sidebar-nav{flex:1;overflow-y:auto;padding:12px 8px;}
.nav-section{margin-bottom:4px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--radius-sm);cursor:pointer;transition:background var(--transition),color var(--transition);color:var(--muted2);font-weight:500;position:relative;user-select:none;}
.nav-item:hover{background:#ffffff08;color:var(--white);}
.nav-item.active{background:linear-gradient(135deg,#0D8A7230,#0B6E5C20);color:var(--teal-bright);border:1px solid #0D8A7240;}
.nav-item .nav-icon{font-size:18px;width:24px;text-align:center;flex-shrink:0;}
.nav-item .nav-label{flex:1;}
.nav-badge{background:var(--red);color:#fff;font-size:11px;font-weight:700;padding:2px 7px;border-radius:20px;min-width:20px;text-align:center;}
.sidebar-footer{padding:16px;border-top:1px solid #ffffff08;flex-shrink:0;}
.admin-email{font-size:11px;color:var(--muted);margin-bottom:10px;word-break:break-all;}
.btn-logout{width:100%;padding:9px;border:1px solid #ffffff14;border-radius:var(--radius-sm);background:transparent;color:var(--muted2);font-family:inherit;font-size:13px;cursor:pointer;transition:all var(--transition);}
.btn-logout:hover{background:var(--red);border-color:var(--red);color:#fff;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
#topbar{height:var(--topbar-h);background:var(--ink2);border-bottom:1px solid #ffffff08;display:flex;align-items:center;padding:0 24px;gap:16px;flex-shrink:0;}
#hamburger{display:none;background:none;border:none;color:var(--white);font-size:22px;cursor:pointer;padding:4px;}
.topbar-title{font-family:'Playfair Display',serif;font-size:20px;color:var(--white);flex:1;}
.topbar-actions{display:flex;align-items:center;gap:10px;}
.btn-topbar{padding:8px 16px;border-radius:var(--radius-sm);border:1px solid #ffffff14;background:transparent;color:var(--muted2);font-family:inherit;font-size:13px;cursor:pointer;transition:all var(--transition);}
.btn-topbar:hover{background:#ffffff0a;color:var(--white);}
#content{flex:1;overflow-y:auto;padding:24px;}

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel{display:none;}
.panel.active{display:block;}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;}
.stat-card{background:var(--card);border:1px solid #ffffff0a;border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:50%;filter:blur(30px);opacity:.3;}
.stat-card.revenue::before{background:var(--gold);}
.stat-card.orders::before{background:var(--teal);}
.stat-card.products::before{background:#6366f1;}
.stat-card.pending::before{background:var(--red);}
.stat-label{font-size:12px;color:var(--muted2);font-weight:600;text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px;}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:36px;line-height:1;letter-spacing:1px;}
.stat-card.revenue .stat-val{color:var(--gold-bright);}
.stat-card.orders .stat-val{color:var(--teal-bright);}
.stat-card.products .stat-val{color:#818cf8;}
.stat-card.pending .stat-val{color:#f87171;}
.stat-sub{font-size:11px;color:var(--muted);margin-top:6px;}

/* ‚îÄ‚îÄ QUICK ACTIONS ‚îÄ‚îÄ */
.quick-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;}
.quick-card{background:var(--card2);border:1px solid #ffffff0a;border-radius:var(--radius);padding:20px;cursor:pointer;transition:all var(--transition);text-align:center;}
.quick-card:hover{border-color:var(--teal-mid);transform:translateY(-2px);box-shadow:0 8px 30px #0D8A7220;}
.quick-icon{font-size:28px;margin-bottom:10px;}
.quick-title{font-weight:600;font-size:13px;color:var(--white);}
.quick-sub{font-size:11px;color:var(--muted);margin-top:3px;}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.section-title{font-family:'Playfair Display',serif;font-size:18px;color:var(--white);}

/* ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ */
.table-wrap{background:var(--card);border:1px solid #ffffff0a;border-radius:var(--radius);overflow:hidden;}
.tbl-scroll{overflow-x:auto;}
table{width:100%;border-collapse:collapse;white-space:nowrap;}
thead th{background:var(--card2);padding:12px 16px;text-align:left;font-size:11px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:.8px;border-bottom:1px solid #ffffff08;}
tbody tr{border-bottom:1px solid #ffffff06;transition:background var(--transition);}
tbody tr:last-child{border-bottom:none;}
tbody tr:hover{background:#ffffff04;}
tbody td{padding:12px 16px;font-size:13px;color:var(--white);}

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;}
.badge-teal{background:#0D8A7230;color:var(--teal-bright);border:1px solid #0D8A7250;}
.badge-gold{background:#C8891A25;color:var(--gold-bright);border:1px solid #C8891A40;}
.badge-red{background:#DC262620;color:#f87171;border:1px solid #DC262640;}
.badge-muted{background:#ffffff0a;color:var(--muted2);border:1px solid #ffffff14;}
.badge-purple{background:#6366f120;color:#a5b4fc;border:1px solid #6366f140;}
.badge-green{background:#16a34a20;color:#4ade80;border:1px solid #16a34a40;}
.badge-hot{background:#ef444420;color:#fca5a5;border:1px solid #ef444440;}
.badge-new{background:#3b82f620;color:#93c5fd;border:1px solid #3b82f640;}
.badge-pick{background:#f59e0b20;color:#fcd34d;border:1px solid #f59e0b40;}

/* ‚îÄ‚îÄ FILTER TABS ‚îÄ‚îÄ */
.filter-tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;}
.filter-tab{padding:7px 16px;border-radius:20px;border:1px solid #ffffff14;background:transparent;color:var(--muted2);font-family:inherit;font-size:13px;cursor:pointer;transition:all var(--transition);}
.filter-tab:hover{border-color:var(--teal-mid);color:var(--teal-bright);}
.filter-tab.active{background:var(--teal);border-color:var(--teal-mid);color:#fff;}

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.search-bar{display:flex;gap:10px;margin-bottom:16px;}
.search-input{flex:1;background:var(--card);border:1px solid #ffffff14;border-radius:var(--radius-sm);padding:10px 14px;color:var(--white);font-family:inherit;font-size:13px;outline:none;transition:border-color var(--transition);}
.search-input:focus{border-color:var(--teal-bright);}
.search-input::placeholder{color:var(--muted);}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{padding:9px 18px;border-radius:var(--radius-sm);border:none;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all var(--transition);display:inline-flex;align-items:center;gap:6px;}
.btn-primary{background:linear-gradient(135deg,var(--teal),var(--teal-mid));color:#fff;}
.btn-primary:hover{opacity:.85;transform:translateY(-1px);}
.btn-gold{background:linear-gradient(135deg,var(--gold-deep),var(--gold));color:#fff;}
.btn-gold:hover{opacity:.85;}
.btn-danger{background:var(--red);color:#fff;}
.btn-danger:hover{opacity:.85;}
.btn-outline{background:transparent;border:1px solid #ffffff20;color:var(--muted2);}
.btn-outline:hover{background:#ffffff0a;color:var(--white);}
.btn-sm{padding:6px 12px;font-size:12px;}
.btn-icon{padding:6px 8px;font-size:16px;}
.btn-full{width:100%;justify-content:center;}

/* ‚îÄ‚îÄ PRODUCT THUMB ‚îÄ‚îÄ */
.prod-thumb{width:40px;height:40px;border-radius:8px;object-fit:cover;background:var(--ink2);border:1px solid #ffffff10;font-size:20px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.prod-thumb-wrap{display:flex;align-items:center;gap:10px;}
.prod-name{font-weight:600;font-size:13px;}
.prod-spec{font-size:11px;color:var(--muted2);margin-top:1px;}

/* ‚îÄ‚îÄ STATUS DROPDOWN ‚îÄ‚îÄ */
.status-select{background:var(--ink2);border:1px solid #ffffff14;border-radius:6px;color:var(--white);font-family:inherit;font-size:12px;padding:5px 8px;cursor:pointer;outline:none;}

/* ‚îÄ‚îÄ CATEGORIES GRID ‚îÄ‚îÄ */
.cat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;}
.cat-chip{background:var(--card);border:1px solid #ffffff0a;border-radius:var(--radius);padding:20px;transition:all var(--transition);}
.cat-chip:hover{border-color:var(--teal-mid);transform:translateY(-2px);}
.cat-chip-icon{font-size:32px;margin-bottom:10px;}
.cat-chip-label{font-weight:700;font-size:14px;margin-bottom:2px;}
.cat-chip-key{font-size:11px;color:var(--muted);font-family:monospace;margin-bottom:10px;}
.cat-chip-stats{display:flex;gap:8px;margin-bottom:12px;font-size:11px;}
.cat-stat{background:var(--ink2);padding:3px 8px;border-radius:4px;color:var(--muted2);}
.cat-stat span{color:var(--white);font-weight:600;}

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.settings-section{background:var(--card);border:1px solid #ffffff0a;border-radius:var(--radius);padding:24px;}
.settings-section h3{font-family:'Playfair Display',serif;font-size:16px;margin-bottom:16px;color:var(--gold-bright);}
.form-group{margin-bottom:16px;}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--muted2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px;}
.form-input{width:100%;background:var(--ink2);border:1px solid #ffffff14;border-radius:var(--radius-sm);padding:10px 14px;color:var(--white);font-family:inherit;font-size:14px;outline:none;transition:border-color var(--transition);}
.form-input:focus{border-color:var(--teal-bright);}
textarea.form-input{resize:vertical;min-height:80px;}
.toggle-wrap{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid #ffffff08;}
.toggle-wrap:last-child{border-bottom:none;}
.toggle-label{font-size:14px;font-weight:500;}
.toggle-sub{font-size:11px;color:var(--muted);margin-top:1px;}
.toggle{position:relative;width:44px;height:24px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;position:absolute;}
.toggle-track{position:absolute;inset:0;background:#ffffff14;border-radius:12px;cursor:pointer;transition:background var(--transition);}
.toggle input:checked ~ .toggle-track{background:var(--teal-mid);}
.toggle-thumb{position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform var(--transition);pointer-events:none;}
.toggle input:checked ~ .toggle-track ~ .toggle-thumb{transform:translateX(20px);}
.row-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:#000000c0;z-index:1000;display:none;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto;}
.modal-overlay.open{display:flex;}
.modal{background:var(--card);border:1px solid #ffffff12;border-radius:20px;width:100%;max-width:620px;margin:auto;box-shadow:0 24px 80px #000000a0;}
.modal-header{padding:24px 28px 20px;border-bottom:1px solid #ffffff08;display:flex;align-items:center;justify-content:space-between;}
.modal-title{font-family:'Playfair Display',serif;font-size:20px;}
.modal-close{background:none;border:none;color:var(--muted2);font-size:22px;cursor:pointer;padding:4px;transition:color var(--transition);}
.modal-close:hover{color:var(--white);}
.modal-body{padding:24px 28px;max-height:70vh;overflow-y:auto;}
.modal-footer{padding:20px 28px;border-top:1px solid #ffffff08;display:flex;gap:10px;justify-content:flex-end;}

/* ‚îÄ‚îÄ CATEGORY AUTOCOMPLETE ‚îÄ‚îÄ */
.cat-input-wrap{position:relative;}
.cat-dropdown{position:absolute;top:100%;left:0;right:0;background:var(--card2);border:1px solid var(--teal-mid);border-radius:var(--radius-sm);z-index:500;max-height:200px;overflow-y:auto;display:none;}
.cat-dropdown.open{display:block;}
.cat-opt{padding:9px 14px;cursor:pointer;transition:background var(--transition);display:flex;align-items:center;gap:8px;font-size:13px;}
.cat-opt:hover{background:#ffffff0a;}
.cat-opt-create{color:var(--teal-bright);font-style:italic;}

/* ‚îÄ‚îÄ IMAGE UPLOAD ‚îÄ‚îÄ */
.img-drop{border:2px dashed #ffffff18;border-radius:var(--radius-sm);padding:24px;text-align:center;cursor:pointer;transition:all var(--transition);background:var(--ink2);}
.img-drop:hover,.img-drop.drag{border-color:var(--teal-mid);background:#0D8A7210;}
.img-drop-text{font-size:13px;color:var(--muted2);}
.img-preview-wrap{margin-top:12px;display:flex;gap:10px;align-items:flex-start;}
.img-preview{width:80px;height:80px;border-radius:8px;object-fit:cover;border:1px solid #ffffff14;display:none;}
.url-preview-wrap{display:flex;gap:8px;margin-top:10px;}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast-container{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);z-index:9990;display:flex;flex-direction:column;align-items:center;gap:8px;pointer-events:none;}
.toast{background:var(--card2);border:1px solid #ffffff14;border-radius:var(--radius-sm);padding:12px 20px;font-size:13px;font-weight:500;color:var(--white);animation:slideUp .3s ease;box-shadow:0 8px 30px #000000a0;pointer-events:auto;}
.toast.success{border-color:#16a34a60;color:#4ade80;}
.toast.error{border-color:var(--red);color:#f87171;}
.toast.info{border-color:var(--teal-mid);}
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeOut{to{opacity:0;transform:translateY(-10px);}}

/* ‚îÄ‚îÄ ORDER NOTIFICATION ‚îÄ‚îÄ */
#order-notif{position:fixed;top:80px;right:24px;z-index:9000;background:var(--card2);border:1px solid var(--gold-mid);border-radius:var(--radius);padding:16px 20px;max-width:320px;display:none;animation:slideInRight .4s ease;}
@keyframes slideInRight{from{opacity:0;transform:translateX(40px);}to{opacity:1;transform:translateX(0);}}
.notif-title{font-weight:700;color:var(--gold-bright);margin-bottom:4px;}
.notif-body{font-size:13px;color:var(--muted2);}

/* ‚îÄ‚îÄ CONFIRM DIALOG ‚îÄ‚îÄ */
#confirm-overlay{position:fixed;inset:0;background:#000000c0;z-index:2000;display:none;align-items:center;justify-content:center;}
#confirm-overlay.open{display:flex;}
.confirm-box{background:var(--card);border:1px solid #ffffff12;border-radius:var(--radius);padding:32px;max-width:400px;width:100%;text-align:center;box-shadow:0 20px 60px #000000a0;}
.confirm-icon{font-size:40px;margin-bottom:12px;}
.confirm-title{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:8px;}
.confirm-msg{font-size:13px;color:var(--muted2);margin-bottom:24px;}
.confirm-btns{display:flex;gap:10px;justify-content:center;}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.spinner{display:inline-block;width:18px;height:18px;border:2px solid #ffffff20;border-top-color:var(--teal-bright);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading-overlay{display:flex;align-items:center;justify-content:center;padding:60px;color:var(--muted2);}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state{text-align:center;padding:60px 20px;color:var(--muted2);}
.empty-state-icon{font-size:48px;margin-bottom:12px;opacity:.5;}
.empty-state h3{font-size:16px;color:var(--muted2);margin-bottom:4px;}
.empty-state p{font-size:13px;}

/* ‚îÄ‚îÄ REFERRAL TABLE ‚îÄ‚îÄ */
.tier-bronze{color:#cd7f32;}
.tier-silver{color:#c0c0c0;}
.tier-gold{color:var(--gold-bright);}
.tier-platinum{color:#e5e4e2;}

/* ‚îÄ‚îÄ SEED PANEL ‚îÄ‚îÄ */
.warning-box{background:#DC262615;border:1px solid #DC262640;border-radius:var(--radius-sm);padding:16px;margin-bottom:20px;color:#f87171;font-size:13px;}

/* ‚îÄ‚îÄ OVERLAY (mobile sidebar) ‚îÄ‚îÄ */
#sidebar-overlay{position:fixed;inset:0;background:#000000a0;z-index:190;display:none;}
#sidebar-overlay.open{display:block;}

/* ‚îÄ‚îÄ ORDER DETAIL ‚îÄ‚îÄ */
.order-detail-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #ffffff08;font-size:13px;}
.order-detail-row:last-child{border-bottom:none;}
.order-detail-label{color:var(--muted2);}
.order-items-table{width:100%;border-collapse:collapse;margin-top:12px;}
.order-items-table th{text-align:left;font-size:11px;color:var(--muted2);padding:6px 0;border-bottom:1px solid #ffffff10;}
.order-items-table td{padding:8px 0;font-size:13px;border-bottom:1px solid #ffffff06;}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:900px){
  #sidebar{position:fixed;left:0;top:0;height:100vh;transform:translateX(-100%);z-index:200;}
  #sidebar.open{transform:translateX(0);}
  #hamburger{display:block;}
  .stats-grid{grid-template-columns:1fr 1fr;}
  .quick-grid{grid-template-columns:1fr 1fr;}
  .settings-grid{grid-template-columns:1fr;}
  #content{padding:16px;}
}
@media(max-width:600px){
  .stats-grid{grid-template-columns:1fr;}
  .quick-grid{grid-template-columns:1fr 1fr;}
  .modal{max-width:100%;margin:0;}
  .modal-overlay{padding:0;align-items:flex-end;}
  .modal{border-radius:20px 20px 0 0;}
  .row-2{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê AUTH SCREEN ‚ïê‚ïê‚ïê -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="auth-logo">
      <h1>GGS Global Consult</h1>
      <p>Admin Dashboard ¬∑ Secure Access</p>
    </div>
    <div class="auth-group">
      <label>Admin Email</label>
      <input type="email" id="login-email" placeholder="admin@ggsglobal.com" autocomplete="email"/>
    </div>
    <div class="auth-group">
      <label>Password</label>
      <input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
    </div>
    <button class="btn-auth" id="login-btn" onclick="doLogin()">Sign In</button>
    <div id="auth-error"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app">
  <!-- SIDEBAR OVERLAY -->
  <div id="sidebar-overlay" onclick="closeSidebar()"></div>

  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">GGS Global</div>
      <div class="sidebar-sub">Admin Panel</div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-item active" data-panel="overview" onclick="switchPanel('overview',this)">
        <span class="nav-icon">üìä</span>
        <span class="nav-label">Overview</span>
      </div>
      <div class="nav-item" data-panel="products" onclick="switchPanel('products',this)">
        <span class="nav-icon">üìã</span>
        <span class="nav-label">Products</span>
      </div>
      <div class="nav-item" data-panel="orders" onclick="switchPanel('orders',this)">
        <span class="nav-icon">üì¶</span>
        <span class="nav-label">Orders</span>
        <span class="nav-badge" id="processing-badge" style="display:none">0</span>
      </div>
      <div class="nav-item" data-panel="categories" onclick="switchPanel('categories',this)">
        <span class="nav-icon">üè∑Ô∏è</span>
        <span class="nav-label">Categories</span>
      </div>
      <div class="nav-item" data-panel="settings" onclick="switchPanel('settings',this)">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-label">Site Settings</span>
      </div>
      <div class="nav-item" data-panel="referrals" onclick="switchPanel('referrals',this)">
        <span class="nav-icon">üéÅ</span>
        <span class="nav-label">Referral Tracker</span>
      </div>
      <div class="nav-item" data-panel="seed" onclick="switchPanel('seed',this)">
        <span class="nav-icon">üå±</span>
        <span class="nav-label">Seed Products</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <div class="admin-email" id="admin-email-display">‚Äî</div>
      <button class="btn-logout" onclick="doLogout()">Sign Out</button>
    </div>
  </nav>

  <!-- MAIN -->
  <div id="main">
    <!-- TOPBAR -->
    <div id="topbar">
      <button id="hamburger" onclick="toggleSidebar()">‚ò∞</button>
      <div class="topbar-title" id="topbar-title">Overview</div>
      <div class="topbar-actions">
        <button class="btn-topbar" onclick="window.open('index.html','_blank')">üåê View Storefront</button>
      </div>
    </div>

    <!-- CONTENT -->
    <div id="content">

      <!-- ‚ïê‚ïê OVERVIEW PANEL ‚ïê‚ïê -->
      <div id="panel-overview" class="panel active">
        <div class="stats-grid">
          <div class="stat-card revenue">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-val" id="stat-revenue">‚Ç¶0</div>
            <div class="stat-sub">From all paid orders</div>
          </div>
          <div class="stat-card orders">
            <div class="stat-label">Total Orders</div>
            <div class="stat-val" id="stat-orders">0</div>
            <div class="stat-sub">All time</div>
          </div>
          <div class="stat-card products">
            <div class="stat-label">Active Products</div>
            <div class="stat-val" id="stat-products">0</div>
            <div class="stat-sub">Visible on storefront</div>
          </div>
          <div class="stat-card pending">
            <div class="stat-label">Pending Orders</div>
            <div class="stat-val" id="stat-pending">0</div>
            <div class="stat-sub">Awaiting processing</div>
          </div>
        </div>
        <div class="quick-grid">
          <div class="quick-card" onclick="switchPanel('products',document.querySelector('[data-panel=products]'));openProductModal()">
            <div class="quick-icon">‚ûï</div>
            <div class="quick-title">Add Product</div>
            <div class="quick-sub">List a new item</div>
          </div>
          <div class="quick-card" onclick="switchPanel('orders',document.querySelector('[data-panel=orders]'))">
            <div class="quick-icon">üì¶</div>
            <div class="quick-title">View Orders</div>
            <div class="quick-sub">Manage fulfillment</div>
          </div>
          <div class="quick-card" onclick="switchPanel('settings',document.querySelector('[data-panel=settings]'))">
            <div class="quick-icon">‚öôÔ∏è</div>
            <div class="quick-title">Site Settings</div>
            <div class="quick-sub">Configure storefront</div>
          </div>
          <div class="quick-card" onclick="window.open('index.html','_blank')">
            <div class="quick-icon">üåê</div>
            <div class="quick-title">View Storefront</div>
            <div class="quick-sub">See live site</div>
          </div>
        </div>
        <div class="section-header">
          <div class="section-title">Recent Orders</div>
        </div>
        <div class="table-wrap">
          <div class="tbl-scroll">
            <table>
              <thead><tr>
                <th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Date</th>
              </tr></thead>
              <tbody id="recent-orders-tbody"><tr><td colspan="5"><div class="loading-overlay"><span class="spinner"></span></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PRODUCTS PANEL ‚ïê‚ïê -->
      <div id="panel-products" class="panel">
        <div class="section-header">
          <div class="section-title">Products</div>
          <button class="btn btn-primary" onclick="openProductModal()">+ Add Product</button>
        </div>
        <div id="product-filter-tabs" class="filter-tabs">
          <button class="filter-tab active" data-cat="all" onclick="filterProducts('all',this)">All</button>
        </div>
        <div class="search-bar">
          <input class="search-input" id="product-search" placeholder="üîç Search by name, spec, category..." oninput="renderProductsTable()"/>
        </div>
        <div class="table-wrap">
          <div class="tbl-scroll">
            <table>
              <thead><tr>
                <th>Product</th><th>Category</th><th>Price</th><th>Status</th><th>Sort</th><th>Actions</th>
              </tr></thead>
              <tbody id="products-tbody"><tr><td colspan="6"><div class="loading-overlay"><span class="spinner"></span></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê ORDERS PANEL ‚ïê‚ïê -->
      <div id="panel-orders" class="panel">
        <div class="section-header">
          <div class="section-title">Orders</div>
          <button class="btn btn-outline" onclick="exportOrdersCSV()">üì• Export CSV</button>
        </div>
        <div class="filter-tabs">
          <button class="filter-tab active" data-status="all" onclick="filterOrders('all',this)">All</button>
          <button class="filter-tab" data-status="paid" onclick="filterOrders('paid',this)">üí≥ Paid (New)</button>
          <button class="filter-tab" data-status="processing" onclick="filterOrders('processing',this)">‚öôÔ∏è Processing</button>
          <button class="filter-tab" data-status="shipped" onclick="filterOrders('shipped',this)">üö¢ Shipped</button>
          <button class="filter-tab" data-status="delivered" onclick="filterOrders('delivered',this)">‚úÖ Delivered</button>
        </div>
        <div class="search-bar">
          <input class="search-input" id="order-search" placeholder="üîç Search by name, email, ref, phone..." oninput="renderOrdersTable()"/>
        </div>
        <div class="table-wrap">
          <div class="tbl-scroll">
            <table>
              <thead><tr>
                <th>Customer</th><th>Items / Shipping</th><th>Total</th><th>Status</th><th>Date</th><th>Actions</th>
              </tr></thead>
              <tbody id="orders-tbody"><tr><td colspan="6"><div class="loading-overlay"><span class="spinner"></span></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê CATEGORIES PANEL ‚ïê‚ïê -->
      <div id="panel-categories" class="panel">
        <div class="section-header">
          <div class="section-title">Categories</div>
        </div>
        <div id="cat-grid" class="cat-grid">
          <div class="loading-overlay"><span class="spinner"></span></div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SETTINGS PANEL ‚ïê‚ïê -->
      <div id="panel-settings" class="panel">
        <div class="section-header">
          <div class="section-title">Site Settings</div>
          <button class="btn btn-primary" onclick="saveSettings()">Save All Changes</button>
        </div>
        <div class="settings-grid">
          <div class="settings-section">
            <h3>üì¢ Announcement &amp; Countdown</h3>
            <div class="form-group">
              <label class="form-label">Announcement Text</label>
              <textarea class="form-input" id="s-announcement" rows="3" placeholder="e.g. Round 7 now open ‚Äî order before deadline!"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Countdown Deadline</label>
              <input type="datetime-local" class="form-input" id="s-countdown"/>
            </div>
          </div>
          <div class="settings-section">
            <h3>üéü Urgency Slots</h3>
            <div class="row-2">
              <div class="form-group">
                <label class="form-label">Total Slots</label>
                <input type="number" class="form-input" id="s-slots-total" placeholder="100"/>
              </div>
              <div class="form-group">
                <label class="form-label">Remaining Slots</label>
                <input type="number" class="form-input" id="s-slots-remaining" placeholder="45"/>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Current Round Label</label>
              <input type="text" class="form-input" id="s-round" placeholder="Round 7"/>
            </div>
          </div>
          <div class="settings-section">
  <h3>üöö Delivery Fees</h3>
  <div class="row-2">
    <div class="form-group">
      <label class="form-label">Port Harcourt (‚Ç¶) ‚Äî FREE</label>
      <input type="number" class="form-input" id="s-fee-ph" placeholder="0" />
    </div>
    <div class="form-group">
      <label class="form-label">South-South / South-East (‚Ç¶)</label>
      <input type="number" class="form-input" id="s-fee-other" placeholder="5000" />
    </div>
  </div>
  <div class="row-2">
    <div class="form-group">
      <label class="form-label">Lagos / Abuja (‚Ç¶)</label>
      <input type="number" class="form-input" id="s-fee-lagos" placeholder="7500" />
    </div>
    <div class="form-group">
      <label class="form-label">Northern States (‚Ç¶)</label>
      <input type="number" class="form-input" id="s-fee-north" placeholder="9000" />
    </div>
  </div>
  <div class="form-group">
    <label class="form-label">WhatsApp Number</label>
    <input type="text" class="form-input" id="s-whatsapp" placeholder="+2348142717585" />
  </div>
</div>
          <div class="settings-section">
            <h3>üîß Store Controls</h3>
            <div class="toggle-wrap">
              <div>
                <div class="toggle-label">Maintenance Mode</div>
                <div class="toggle-sub">Hides storefront from visitors</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="s-maintenance"/>
                <div class="toggle-track"></div>
                <div class="toggle-thumb"></div>
              </label>
            </div>
            <div class="toggle-wrap">
              <div>
                <div class="toggle-label">Accepting Orders</div>
                <div class="toggle-sub">Enables checkout on storefront</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="s-accepting" checked/>
                <div class="toggle-track"></div>
                <div class="toggle-thumb"></div>
              </label>
            </div>
          </div>
          <div class="settings-section" style="grid-column:1/-1;">
            <h3>üéÅ Referral Tiers (min orders to qualify)</h3>
            <div class="row-2" style="grid-template-columns:repeat(4,1fr);">
              <div class="form-group">
                <label class="form-label" style="color:#cd7f32;">ü•â Bronze</label>
                <input type="number" class="form-input" id="s-tier-bronze" placeholder="1"/>
              </div>
              <div class="form-group">
                <label class="form-label" style="color:#c0c0c0;">ü•à Silver</label>
                <input type="number" class="form-input" id="s-tier-silver" placeholder="3"/>
              </div>
              <div class="form-group">
                <label class="form-label" style="color:var(--gold-bright);">ü•á Gold</label>
                <input type="number" class="form-input" id="s-tier-gold" placeholder="5"/>
              </div>
              <div class="form-group">
                <label class="form-label" style="color:#e5e4e2;">üíé Platinum</label>
                <input type="number" class="form-input" id="s-tier-platinum" placeholder="10"/>
              </div>
            </div>
          </div>
        </div>
      </div><div class="settings-section" style="grid-column:1/-1;">
  <h3>ü§ù Agent Section</h3>
  <div class="row-2">
    <div class="form-group">
      <label class="form-label">Commission Rate (%)</label>
      <input type="number" class="form-input" id="s-agent-commission" placeholder="5" />
    </div>
    <div class="form-group">
      <label class="form-label">Min. Qualifying Order (‚Ç¶)</label>
      <input type="number" class="form-input" id="s-agent-min-order" placeholder="200000" />
    </div>
  </div>
  <div class="row-2">
    <div class="form-group">
      <label class="form-label">Earning Example 1 (orders/month)</label>
      <input type="number" class="form-input" id="s-agent-ex1-orders" placeholder="2" />
    </div>
    <div class="form-group">
      <label class="form-label">Average Order Value (‚Ç¶)</label>
      <input type="number" class="form-input" id="s-agent-avg-order" placeholder="500000" />
    </div>
  </div>
  <div class="toggle-wrap">
    <div>
      <div class="toggle-label">Show Agent Section</div>
      <div class="toggle-sub">Hide or show the agent recruitment section on storefront</div>
    </div>
    <label class="toggle">
      <input type="checkbox" id="s-agent-visible" checked />
      <div class="toggle-track"></div>
      <div class="toggle-thumb"></div>
    </label>
  </div>
</div>

      <!-- ‚ïê‚ïê REFERRAL PANEL ‚ïê‚ïê -->
      <div id="panel-referrals" class="panel">
        <div class="section-header">
          <div class="section-title">Referral Tracker</div>
        </div>
        <div class="search-bar">
          <input class="search-input" id="referral-search" placeholder="üîç Search referral codes..." oninput="renderReferrals()"/>
        </div>
        <div class="table-wrap">
          <div class="tbl-scroll">
            <table>
              <thead><tr>
                <th>Referral Code</th><th>Orders</th><th>Total Value</th><th>Tier</th>
              </tr></thead>
              <tbody id="referrals-tbody"><tr><td colspan="4"><div class="loading-overlay"><span class="spinner"></span></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SEED PANEL ‚ïê‚ïê -->
      <div id="panel-seed" class="panel">
        <div class="section-title" style="margin-bottom:20px;">Seed Products</div>
        <div class="warning-box">
          ‚ö†Ô∏è <strong>Warning:</strong> Only run this once. Seeding again will overwrite the fixed product documents with the same IDs. This is intended for initial store setup only.
        </div>
        <button class="btn btn-gold" onclick="runSeeder()">üå± Seed 14 Products (8 Tech + 6 Fashion)</button>
        <div id="seed-output" style="margin-top:16px;font-size:13px;color:var(--muted2);"></div>
      </div>

    </div><!-- /content -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê ORDER NOTIFICATION ‚ïê‚ïê‚ïê -->
<div id="order-notif">
  <div class="notif-title">üõé New Order Received!</div>
  <div class="notif-body" id="order-notif-body">A customer just placed an order.</div>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST CONTAINER ‚ïê‚ïê‚ïê -->
<div id="toast-container"></div>

<!-- ‚ïê‚ïê‚ïê CONFIRM DIALOG ‚ïê‚ïê‚ïê -->
<div id="confirm-overlay">
  <div class="confirm-box">
    <div class="confirm-icon">üóëÔ∏è</div>
    <div class="confirm-title" id="confirm-title">Are you sure?</div>
    <div class="confirm-msg" id="confirm-msg">This action cannot be undone.</div>
    <div class="confirm-btns">
      <button class="btn btn-outline" onclick="resolveConfirm(false)">Cancel</button>
      <button class="btn btn-danger" onclick="resolveConfirm(true)">Delete</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PRODUCT MODAL ‚ïê‚ïê‚ïê -->
<div id="product-modal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="product-modal-title">Add Product</div>
      <button class="modal-close" onclick="closeProductModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="pm-doc-id"/>
      <div class="form-group">
        <label class="form-label">Product Name *</label>
        <input type="text" class="form-input" id="pm-name" placeholder="e.g. iPhone 15 Pro Max"/>
      </div>
      <div class="row-2">
        <div class="form-group">
          <label class="form-label">Price ‚Ç¶ *</label>
          <input type="number" class="form-input" id="pm-price" placeholder="99000"/>
        </div>
        <div class="form-group">
          <label class="form-label">Sort Order</label>
          <input type="number" class="form-input" id="pm-sort" placeholder="1" value="1"/>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Category * (free text)</label>
        <div class="cat-input-wrap">
          <input type="text" class="form-input" id="pm-category" placeholder="e.g. tech, shoes, bags ‚Äî pick from dropdown" autocomplete="off" oninput="onCatInput()" onfocus="onCatInput()" onblur="setTimeout(()=>closeCatDropdown(),200)"/>
          <div class="cat-dropdown" id="cat-dropdown"></div>
        </div>
      </div>
      <div class="row-2">
        <div class="form-group">
          <label class="form-label">Icon (emoji)</label>
          <input type="text" class="form-input" id="pm-icon" placeholder="üì±" maxlength="4"/>
        </div>
        <div class="form-group">
          <label class="form-label">Visibility</label>
          <select class="form-input" id="pm-active">
            <option value="true">Active (visible)</option>
            <option value="false">Hidden</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Short Spec / Subtitle</label>
        <input type="text" class="form-input" id="pm-spec" placeholder="e.g. 256GB, 6.7 inch OLED"/>
      </div>
      <div class="form-group">
        <label class="form-label">Variants (one per line)</label>
        <textarea class="form-input" id="pm-variants" rows="3" placeholder="Black&#10;White&#10;Gold"></textarea>
      </div>
      <div class="row-2">
        <div class="form-group">
          <label class="form-label">Badge Type</label>
          <select class="form-input" id="pm-badge">
            <option value="">None</option>
            <option value="hot">üî• Hot</option>
            <option value="new">‚ú® New</option>
            <option value="pick">‚≠ê Pick</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Badge Text</label>
          <input type="text" class="form-input" id="pm-badge-text" placeholder="Best Seller"/>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Product Image</label>
        <div class="img-drop" id="img-drop" onclick="document.getElementById('pm-file').click()" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
          <div class="img-drop-text">üìÅ Drag &amp; drop image or click to upload<br/><span style="font-size:11px;color:var(--muted)">Max 500KB ‚Äî only JPG/PNG/WebP</span></div>
          <input type="file" id="pm-file" accept="image/*" style="display:none" onchange="handleFileUpload(this)"/>
        </div>
        <div class="img-preview-wrap">
          <img id="pm-img-preview" class="img-preview" src="" alt="Preview" onerror="this.style.display='none'"/>
        </div>
        <div class="url-preview-wrap" style="margin-top:8px;">
          <input type="text" class="form-input" id="pm-img-url" placeholder="Or paste image URL..." style="flex:1;"/>
          <button class="btn btn-outline btn-sm" onclick="previewUrlImage()">Preview</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeProductModal()">Cancel</button>
      <button class="btn btn-primary btn-full" id="pm-save-btn" onclick="saveProduct()" style="flex:2;">
        <span id="pm-save-text">Save Product</span>
        <span id="pm-save-spinner" style="display:none"><span class="spinner"></span></span>
      </button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê ORDER DETAIL MODAL ‚ïê‚ïê‚ïê -->
<div id="order-modal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Order Details</div>
      <button class="modal-close" onclick="closeOrderModal()">‚úï</button>
    </div>
    <div class="modal-body" id="order-modal-body">
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeOrderModal()">Close</button>
      <button class="btn btn-primary" id="wa-btn" onclick="openWhatsApp()">üí¨ WhatsApp Customer</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê FIREBASE ‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, doc, onSnapshot, setDoc, addDoc, updateDoc, deleteDoc, serverTimestamp, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// ‚îÄ‚îÄ FIREBASE CONFIG ‚îÄ‚îÄ
const firebaseConfig = {
  apiKey:"AIzaSyCGU14FHH82Ja5Bx9ZE3ImlePoyKvZLdYg",
  authDomain:"ggs-global.firebaseapp.com",
  projectId:"ggs-global",
  storageBucket:"ggs-global.firebasestorage.app",
  messagingSenderId:"688407888100",
  appId:"1:688407888100:web:a9f3e068ca9624e3b66cf1"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ‚îÄ‚îÄ CAT META ‚îÄ‚îÄ
const CAT_META = {
  tech:    {label:'Tech & Gadgets',     icon:'üì±'},
  fashion: {label:'Fashion & Lifestyle',icon:'üëú'},
  skincare:{label:'Skincare & Beauty',  icon:'‚ú®'},
  home:    {label:'Home & Living',      icon:'üè†'},
  shoes:   {label:'Shoes',             icon:'üëü'},
  watches: {label:'Watches',           icon:'‚åö'},
  bags:    {label:'Bags',              icon:'üëú'},
  gaming:  {label:'Gaming',            icon:'üéÆ'},
  perfume: {label:'Perfumes',          icon:'üå∏'},
  jewelry: {label:'Jewelry',           icon:'üíç'},
  sports:  {label:'Sports & Fitness',  icon:'üí™'},
  kids:    {label:'Kids & Baby',       icon:'üß∏'},
  general: {label:'General',           icon:'üì¶'},
};

// ‚îÄ‚îÄ ESCAPE UTILS ‚îÄ‚îÄ
window.escHtml = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
window.escAttr = s => String(s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'&quot;');

// ‚îÄ‚îÄ GLOBALS ‚îÄ‚îÄ
let allProducts = [];
let allOrders = [];
let siteSettings = {};
let currentProductFilter = 'all';
let currentOrderFilter = 'all';
let currentOrderDoc = null;
let prevOrderCount = null;
let confirmResolve = null;
let editDocId = null;
let unsubProducts = null;
let unsubOrders = null;
let unsubSettings = null;
let tierSettings = {bronze:1,silver:3,gold:5,platinum:10};

// ‚îÄ‚îÄ BEEP ‚îÄ‚îÄ
function playBeep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.frequency.value = 880; osc.type='sine';
    gain.gain.setValueAtTime(.4, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(.001, ctx.currentTime+.6);
    osc.start(); osc.stop(ctx.currentTime+.6);
  }catch(e){}
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
window.showToast = function(msg,type='info'){
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(()=>{t.style.animation='fadeOut .3s ease forwards';setTimeout(()=>t.remove(),300);}, 3200);
};

// ‚îÄ‚îÄ CONFIRM DIALOG ‚îÄ‚îÄ
window.showConfirm = function(title, msg){
  document.getElementById('confirm-title').textContent = title;
  document.getElementById('confirm-msg').textContent = msg;
  document.getElementById('confirm-overlay').classList.add('open');
  return new Promise(res=>{ confirmResolve = res; });
};
window.resolveConfirm = function(val){
  document.getElementById('confirm-overlay').classList.remove('open');
  if(confirmResolve) confirmResolve(val);
  confirmResolve = null;
};

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
window.doLogin = async function(){
  const email = document.getElementById('login-email').value.trim();
  const pass = document.getElementById('login-pass').value;
  const errEl = document.getElementById('auth-error');
  const btn = document.getElementById('login-btn');
  errEl.textContent = '';
  btn.textContent = 'Signing in‚Ä¶';
  btn.disabled = true;
  try{
    await signInWithEmailAndPassword(auth, email, pass);
  }catch(e){
    errEl.textContent = e.message.replace('Firebase: ','').replace(/\(auth\/.*\)/,'');
    btn.textContent = 'Sign In';
    btn.disabled = false;
  }
};

window.doLogout = async function(){
  if(unsubProducts) unsubProducts();
  if(unsubOrders) unsubOrders();
  if(unsubSettings) unsubSettings();
  await signOut(auth);
};

onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById('auth-screen').style.display='none';
    document.getElementById('app').classList.add('visible');
    document.getElementById('admin-email-display').textContent = user.email;
    initListeners();
  } else {
    document.getElementById('auth-screen').style.display='flex';
    document.getElementById('app').classList.remove('visible');
    document.getElementById('login-btn').textContent='Sign In';
    document.getElementById('login-btn').disabled=false;
    allProducts=[]; allOrders=[];
  }
});

// ‚îÄ‚îÄ LISTENERS ‚îÄ‚îÄ
function initListeners(){
  unsubProducts = onSnapshot(collection(db,'products'), snap => {
    allProducts = snap.docs.map(d=>({...d.data(), _id:d.id}));
    renderProductsTable();
    rebuildFilterTabs();
    renderCategoryGrid();
    updateStats();
  });
  unsubOrders = onSnapshot(collection(db,'orders'), snap => {
    const newOrders = snap.docs.map(d=>({...d.data(), _id:d.id}));
    if(prevOrderCount !== null && newOrders.length > prevOrderCount){
      const diff = newOrders.length - prevOrderCount;
      showOrderNotif(`${diff} new order${diff>1?'s':''} just arrived!`);
      playBeep();
    }
    prevOrderCount = newOrders.length;
    allOrders = newOrders;
    renderOrdersTable();
    renderRecentOrders();
    renderReferrals();
    updateStats();
  });
  unsubSettings = onSnapshot(doc(db,'settings','site-config'), snap => {
    if(snap.exists()){
      siteSettings = snap.data();
      populateSettings(siteSettings);
    }
  });
}

function showOrderNotif(msg){
  const notif = document.getElementById('order-notif');
  document.getElementById('order-notif-body').textContent = msg;
  notif.style.display='block';
  setTimeout(()=>{ notif.style.display='none'; }, 5000);
}

// ‚îÄ‚îÄ STATS ‚îÄ‚îÄ
function updateStats(){
  const activeProducts = allProducts.filter(p=>p.active!==false).length;
  // index.html always writes status:"paid" on successful Flutterwave payment
  // orderStatus starts as "processing" and admin updates it to shipped/delivered
  const revenue = allOrders.filter(o=>o.status==='paid').reduce((a,o)=>a+(o.totalPaid||0),0);
  // "Pending" = paid but not yet shipped or delivered (still processing)
  const pending = allOrders.filter(o=>o.status==='paid' && (o.orderStatus==='processing'||!o.orderStatus)).length;
  document.getElementById('stat-revenue').textContent = '‚Ç¶'+revenue.toLocaleString();
  document.getElementById('stat-orders').textContent = allOrders.length;
  document.getElementById('stat-products').textContent = activeProducts;
  document.getElementById('stat-pending').textContent = pending;
  const badge = document.getElementById('processing-badge');
  // Badge shows orders needing action = paid + processing orderStatus
  const proc = allOrders.filter(o=>o.status==='paid' && (o.orderStatus==='processing'||!o.orderStatus)).length;
  badge.style.display = proc>0?'':'none';
  badge.textContent = proc;
}

// ‚îÄ‚îÄ PANEL SWITCHING ‚îÄ‚îÄ
window.switchPanel = function(name, el){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  if(el) el.classList.add('active');
  else { const navEl = document.querySelector(`[data-panel="${name}"]`); if(navEl) navEl.classList.add('active'); }
  const titles = {overview:'Overview',products:'Products',orders:'Orders',categories:'Categories',settings:'Site Settings',referrals:'Referral Tracker',seed:'Seed Products'};
  document.getElementById('topbar-title').textContent = titles[name]||name;
  closeSidebar();
};

// ‚îÄ‚îÄ SIDEBAR MOBILE ‚îÄ‚îÄ
window.toggleSidebar = function(){
  const s = document.getElementById('sidebar');
  const o = document.getElementById('sidebar-overlay');
  s.classList.toggle('open');
  o.classList.toggle('open');
};
window.closeSidebar = function(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê PRODUCTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.filterProducts = function(cat, el){
  currentProductFilter = cat;
  document.querySelectorAll('#product-filter-tabs .filter-tab').forEach(t=>t.classList.remove('active'));
  if(el) el.classList.add('active');
  renderProductsTable();
};

function rebuildFilterTabs(){
  const cats = [...new Set(allProducts.map(p=>p.category).filter(Boolean))];
  const tabs = document.getElementById('product-filter-tabs');
  const existing = tabs.querySelector('[data-cat="all"]');
  tabs.innerHTML='';
  const all = document.createElement('button');
  all.className='filter-tab'+(currentProductFilter==='all'?' active':'');
  all.dataset.cat='all'; all.textContent='All';
  all.onclick=()=>filterProducts('all',all);
  tabs.appendChild(all);
  cats.sort().forEach(c=>{
    const btn = document.createElement('button');
    btn.className='filter-tab'+(currentProductFilter===c?' active':'');
    btn.dataset.cat=c;
    const meta = CAT_META[c];
    btn.textContent = (meta?meta.icon+' '+meta.label:c);
    btn.onclick=()=>filterProducts(c,btn);
    tabs.appendChild(btn);
  });
  const hidden = document.createElement('button');
  hidden.className='filter-tab'+(currentProductFilter==='_hidden'?' active':'');
  hidden.dataset.cat='_hidden'; hidden.textContent='üôà Hidden';
  hidden.onclick=()=>filterProducts('_hidden',hidden);
  tabs.appendChild(hidden);
}

window.renderProductsTable = function(){
  const q = (document.getElementById('product-search').value||'').toLowerCase();
  let prods = [...allProducts];
  if(currentProductFilter==='_hidden') prods=prods.filter(p=>p.active===false);
  else if(currentProductFilter!=='all') prods=prods.filter(p=>p.category===currentProductFilter && p.active!==false);
  if(q) prods=prods.filter(p=>(p.name||'').toLowerCase().includes(q)||(p.spec||'').toLowerCase().includes(q)||(p.category||'').toLowerCase().includes(q));
  prods.sort((a,b)=>((a.sortOrder||a.order||0)-(b.sortOrder||b.order||0)));
  const tbody = document.getElementById('products-tbody');
  if(!prods.length){
    tbody.innerHTML=`<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>No products found</h3><p>Try a different filter or add a product.</p></div></td></tr>`;
    return;
  }
  tbody.innerHTML = prods.map(p=>{
    const catMeta = CAT_META[p.category];
    const catLabel = catMeta ? catMeta.icon+' '+catMeta.label : escHtml(p.category||'‚Äî');
    const badge = p.active===false
      ? '<span class="badge badge-muted">üôà Hidden</span>'
      : '<span class="badge badge-teal">üëÅ Active</span>';
    const badgeTag = p.badge ? `<span class="badge badge-${p.badge==='hot'?'hot':p.badge==='new'?'new':'pick'}" style="margin-left:4px;">${escHtml(p.badgeText||p.badge)}</span>` : '';
    const imgSrc = p.img || '';
    return `<tr>
      <td>
        <div class="prod-thumb-wrap">
          ${imgSrc
            ? `<img class="prod-thumb" src="${escAttr(imgSrc)}" alt="" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/><div class="prod-thumb" style="display:none">${escHtml(p.icon||'üì¶')}</div>`
            : `<div class="prod-thumb">${escHtml(p.icon||'üì¶')}</div>`}
          <div>
            <div class="prod-name">${escHtml(p.name)}${badgeTag}</div>
            <div class="prod-spec">${escHtml(p.spec||'')}</div>
          </div>
        </div>
      </td>
      <td><span class="badge badge-muted">${catLabel}</span></td>
      <td style="font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--gold-bright);">‚Ç¶${(p.price||0).toLocaleString()}</td>
      <td>${badge}</td>
      <td>${p.sortOrder||0}</td>
      <td>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-outline btn-sm btn-icon" title="Edit" onclick="openProductModal('${escAttr(p._id)}')">‚úèÔ∏è</button>
          <button class="btn btn-outline btn-sm btn-icon" title="${p.active===false?'Show':'Hide'}" onclick="toggleProductVisibility('${escAttr(p._id)}',${p.active===false})">${p.active===false?'üëÅ':'üôà'}</button>
          <button class="btn btn-danger btn-sm btn-icon" title="Delete" onclick="deleteProduct('${escAttr(p._id)}','${escAttr(p.name||'')}')">üóëÔ∏è</button>
        </div>
      </td>
    </tr>`;
  }).join('');
};

window.toggleProductVisibility = async function(id, makeActive){
  try{
    await updateDoc(doc(db,'products',id),{active:makeActive, updatedAt:serverTimestamp()});
    showToast(makeActive?'Product is now visible.':'Product hidden.','success');
  }catch(e){ showToast('Error: '+e.message,'error'); }
};

window.deleteProduct = async function(id, name){
  const ok = await showConfirm('Delete Product?', `"${name}" will be permanently removed from your store.`);
  if(!ok) return;
  try{
    await deleteDoc(doc(db,'products',id));
    showToast('Product deleted.','success');
  }catch(e){ showToast('Error: '+e.message,'error'); }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê PRODUCT MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.openProductModal = function(docId){
  editDocId = docId || null;
  const modal = document.getElementById('product-modal');
  document.getElementById('product-modal-title').textContent = editDocId ? 'Edit Product' : 'Add Product';
  document.getElementById('pm-doc-id').value = editDocId||'';
  // reset
  ['pm-name','pm-price','pm-category','pm-icon','pm-spec','pm-variants','pm-badge-text','pm-img-url'].forEach(id=>{ document.getElementById(id).value=''; });
  document.getElementById('pm-sort').value='1';
  document.getElementById('pm-badge').value='';
  document.getElementById('pm-active').value='true';
  document.getElementById('pm-img-preview').style.display='none';
  document.getElementById('pm-img-preview').src='';
  if(editDocId){
    const p = allProducts.find(x=>x._id===editDocId);
    if(p){
      document.getElementById('pm-name').value=p.name||'';
      document.getElementById('pm-price').value=p.price||'';
      document.getElementById('pm-category').value=p.category||'';
      document.getElementById('pm-icon').value=p.icon||'';
      document.getElementById('pm-spec').value=p.spec||'';
      document.getElementById('pm-variants').value=(p.variants||[]).join('\n');
      document.getElementById('pm-badge').value=p.badge||'';
      document.getElementById('pm-badge-text').value=p.badgeText||'';
      document.getElementById('pm-img-url').value=p.img||'';
      document.getElementById('pm-active').value=p.active===false?'false':'true';
      document.getElementById('pm-sort').value=p.sortOrder||1;
      if(p.img){ const pr=document.getElementById('pm-img-preview'); pr.src=p.img; pr.style.display='block'; }
    }
  }
  modal.classList.add('open');
};

window.closeProductModal = function(){
  document.getElementById('product-modal').classList.remove('open');
  editDocId = null;
};

window.saveProduct = async function(){
  const name = document.getElementById('pm-name').value.trim();
  const price = parseFloat(document.getElementById('pm-price').value);
  const catRaw = document.getElementById('pm-category').value.trim();
  if(!name||!price||!catRaw){ showToast('Name, price and category are required.','error'); return; }
  const category = catRaw.toLowerCase().trim().replace(/\s+/g,'-');
  const icon = document.getElementById('pm-icon').value.trim().slice(0,4);
  const spec = document.getElementById('pm-spec').value.trim();
  const variants = document.getElementById('pm-variants').value.split('\n').map(v=>v.trim()).filter(Boolean);
  const badge = document.getElementById('pm-badge').value||'';
  const badgeText = document.getElementById('pm-badge-text').value.trim();
  const active = document.getElementById('pm-active').value==='true';
  const sortOrder = parseInt(document.getElementById('pm-sort').value)||1;
  // image
  let img = document.getElementById('pm-img-url').value.trim();
  const pr = document.getElementById('pm-img-preview');
  if(pr.src && pr.src.startsWith('data:')) img = pr.src;
  const data = {name,price,category,icon,spec,variants,badge,badgeText,img,active,sortOrder,updatedAt:serverTimestamp()};
  // save spinner
  document.getElementById('pm-save-text').style.display='none';
  document.getElementById('pm-save-spinner').style.display='inline-flex';
  try{
    if(editDocId){
      await updateDoc(doc(db,'products',editDocId), data);
      showToast('Product updated!','success');
    } else {
      data.createdAt = serverTimestamp();
      await addDoc(collection(db,'products'), data);
      showToast('Product added!','success');
    }
    closeProductModal();
  }catch(e){ showToast('Error: '+e.message,'error'); }
  document.getElementById('pm-save-text').style.display='';
  document.getElementById('pm-save-spinner').style.display='none';
};

// ‚îÄ‚îÄ CATEGORY AUTOCOMPLETE ‚îÄ‚îÄ
window.onCatInput = function(){
  const val = (document.getElementById('pm-category').value||'').toLowerCase().trim();
  const dd = document.getElementById('cat-dropdown');
  const firestoreCats = [...new Set(allProducts.map(p=>p.category).filter(Boolean))];
  const allKeys = [...new Set([...firestoreCats, ...Object.keys(CAT_META)])];
  let opts = allKeys.filter(k=>!val||k.includes(val)||((CAT_META[k]&&CAT_META[k].label)||'').toLowerCase().includes(val));
  dd.innerHTML='';
  opts.slice(0,10).forEach(k=>{
    const meta = CAT_META[k];
    const div = document.createElement('div');
    div.className='cat-opt';
    div.innerHTML = `<span>${meta?meta.icon:'üì¶'}</span><span>${escHtml(meta?meta.label:k)}</span><span style="color:var(--muted);font-size:11px;margin-left:auto;">${escHtml(k)}</span>`;
    div.onclick=()=>{ document.getElementById('pm-category').value=k; closeCatDropdown(); };
    dd.appendChild(div);
  });
  if(val && !allKeys.includes(val)){
    const create = document.createElement('div');
    create.className='cat-opt cat-opt-create';
    create.innerHTML=`<span>‚ú®</span><span>Create new: <strong>${escHtml(val)}</strong></span>`;
    create.onclick=()=>{ document.getElementById('pm-category').value=val; closeCatDropdown(); };
    dd.appendChild(create);
  }
  dd.classList.toggle('open', dd.children.length>0);
};
window.closeCatDropdown = function(){ document.getElementById('cat-dropdown').classList.remove('open'); };

// ‚îÄ‚îÄ IMAGE HANDLING ‚îÄ‚îÄ
window.handleDragOver = function(e){ e.preventDefault(); document.getElementById('img-drop').classList.add('drag'); };
window.handleDrop = function(e){
  e.preventDefault();
  document.getElementById('img-drop').classList.remove('drag');
  const file = e.dataTransfer.files[0];
  if(file) processImageFile(file);
};
window.handleFileUpload = function(input){ if(input.files[0]) processImageFile(input.files[0]); };

function processImageFile(file){
  if(file.size > 500*1024){ showToast('Image too large! Max 500KB allowed.','error'); return; }
  const reader = new FileReader();
  reader.onload = e=>{
    const pr = document.getElementById('pm-img-preview');
    pr.src = e.target.result; pr.style.display='block';
    document.getElementById('pm-img-url').value='';
  };
  reader.readAsDataURL(file);
}

window.previewUrlImage = function(){
  const url = document.getElementById('pm-img-url').value.trim();
  if(!url) return;
  const pr = document.getElementById('pm-img-preview');
  pr.src=url; pr.style.display='block';
  pr.onerror=()=>{ pr.style.display='none'; showToast('Could not load image from URL.','error'); };
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê ORDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.filterOrders = function(status, el){
  currentOrderFilter = status;
  document.querySelectorAll('#panel-orders .filter-tab').forEach(t=>t.classList.remove('active'));
  if(el) el.classList.add('active');
  renderOrdersTable();
};

window.renderOrdersTable = function(){
  const q = (document.getElementById('order-search').value||'').toLowerCase();
  let orders = [...allOrders];
  // index.html schema: status="paid" (payment), orderStatus="processing|shipped|delivered" (fulfillment)
  if(currentOrderFilter==='paid'){
    // Show all payment-confirmed orders (regardless of fulfillment stage)
    orders=orders.filter(o=>o.status==='paid');
  } else if(currentOrderFilter==='processing'){
    orders=orders.filter(o=>o.orderStatus==='processing'||(!o.orderStatus&&o.status==='paid'));
  } else if(currentOrderFilter==='shipped'){
    orders=orders.filter(o=>o.orderStatus==='shipped');
  } else if(currentOrderFilter==='delivered'){
    orders=orders.filter(o=>o.orderStatus==='delivered');
  }
  if(q){
    orders = orders.filter(o=>{
      const c = o.customer||{};
      return (c.firstName||'').toLowerCase().includes(q)
        ||(c.lastName||'').toLowerCase().includes(q)
        ||(c.email||'').toLowerCase().includes(q)
        ||(c.phone||'').toLowerCase().includes(q)
        ||(o.txRef||'').toLowerCase().includes(q);
    });
  }
  orders.sort((a,b)=>{
    const at = a.createdAt?.toMillis?a.createdAt.toMillis():0;
    const bt = b.createdAt?.toMillis?b.createdAt.toMillis():0;
    return bt-at;
  });
  const tbody = document.getElementById('orders-tbody');
  if(!orders.length){
    tbody.innerHTML=`<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>No orders found</h3><p>Try a different filter.</p></div></td></tr>`;
    return;
  }
  tbody.innerHTML=orders.map(o=>{
    const c=o.customer||{};
    const name=escHtml((c.firstName||'')+(c.lastName?' '+c.lastName:''));
    // Payment status (from Flutterwave - index.html always writes status:"paid")
    const payStatus = o.status||'pending';
    // Fulfillment status (admin-managed via orderStatus field)
    const fulfillStatus = o.orderStatus||'processing';
    const fulfillClass={'processing':'badge-gold','shipped':'badge-purple','delivered':'badge-green'}[fulfillStatus]||'badge-muted';
    const items=o.items||[];
    const date=o.createdAt?.toDate?o.createdAt.toDate().toLocaleDateString('en-NG',{day:'2-digit',month:'short',year:'numeric'}):'‚Äî';
    return `<tr>
      <td>
        <div style="font-weight:600;">${name}</div>
        <div style="font-size:11px;color:var(--muted2);">${escHtml(c.phone||'')} ¬∑ ${escHtml(c.state||'')}</div>
      </td>
      <td>
        <div>${items.length} item${items.length!==1?'s':''}</div>
        <div style="font-size:11px;color:var(--muted2);">${escHtml(o.shippingMethod||'Standard')}</div>
      </td>
      <td style="font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--gold-bright);">‚Ç¶${(o.totalPaid||0).toLocaleString()}</td>
      <td>
        <div style="display:flex;flex-direction:column;gap:5px;">
          <span class="badge badge-teal" style="font-size:10px;">üí≥ ${payStatus}</span>
          <select class="status-select" onchange="updateOrderStatus('${escAttr(o._id)}',this.value)">
            <option value="processing"${fulfillStatus==='processing'?' selected':''}>‚öôÔ∏è Processing</option>
            <option value="shipped"${fulfillStatus==='shipped'?' selected':''}>üö¢ Shipped</option>
            <option value="delivered"${fulfillStatus==='delivered'?' selected':''}>‚úÖ Delivered</option>
          </select>
        </div>
      </td>
      <td style="font-size:12px;color:var(--muted2);">${date}</td>
      <td>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-outline btn-sm btn-icon" title="View" onclick="viewOrderDetail('${escAttr(o._id)}')">üëÅ</button>
          <button class="btn btn-outline btn-sm btn-icon" title="WhatsApp" onclick="openWhatsAppDirect('${escAttr(o._id)}')">üí¨</button>
        </div>
      </td>
    </tr>`;
  }).join('');
};

window.updateOrderStatus = async function(id, status){
  try{
    // Only update orderStatus (fulfillment stage) ‚Äî never touch status (payment confirmation)
    await updateDoc(doc(db,'orders',id),{orderStatus:status, updatedAt:serverTimestamp()});
    showToast('Order status updated.','success');
  }catch(e){ showToast('Error: '+e.message,'error'); }
};

function renderRecentOrders(){
  const orders = [...allOrders].sort((a,b)=>{
    const at=a.createdAt?.toMillis?a.createdAt.toMillis():0;
    const bt=b.createdAt?.toMillis?b.createdAt.toMillis():0;
    return bt-at;
  }).slice(0,8);
  const tbody = document.getElementById('recent-orders-tbody');
  if(!orders.length){
    tbody.innerHTML=`<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>No orders yet</h3></div></td></tr>`;
    return;
  }
  tbody.innerHTML=orders.map(o=>{
    const c=o.customer||{};
    const name=escHtml((c.firstName||'')+(c.lastName?' '+c.lastName:''));
    const fulfillStatus=o.orderStatus||'processing';
    const stClass={'processing':'badge-gold','shipped':'badge-purple','delivered':'badge-green'}[fulfillStatus]||'badge-muted';
    const date=o.createdAt?.toDate?o.createdAt.toDate().toLocaleDateString('en-NG',{day:'2-digit',month:'short'}):'‚Äî';
    return `<tr>
      <td>${name}</td>
      <td>${(o.items||[]).length} item(s)</td>
      <td style="font-family:'Bebas Neue',sans-serif;color:var(--gold-bright);">‚Ç¶${(o.totalPaid||0).toLocaleString()}</td>
      <td><span class="badge ${stClass}">${fulfillStatus}</span></td>
      <td>${date}</td>
    </tr>`;
  }).join('');
}

window.viewOrderDetail = function(id){
  const o = allOrders.find(x=>x._id===id);
  if(!o) return;
  currentOrderDoc = o;
  const c=o.customer||{};
  const items=o.items||[];
  const date=o.createdAt?.toDate?o.createdAt.toDate().toLocaleString('en-NG'):'‚Äî';
  const payStatus = o.status||'pending';
  const fulfillStatus = o.orderStatus||'processing';
  document.getElementById('order-modal-body').innerHTML=`
    <h4 style="font-family:'Playfair Display',serif;margin-bottom:12px;color:var(--gold-bright);">Customer Info</h4>
    <div class="order-detail-row"><span class="order-detail-label">Name</span><span>${escHtml(c.firstName||'')} ${escHtml(c.lastName||'')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Email</span><span>${escHtml(c.email||'‚Äî')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Phone</span><span>${escHtml(c.phone||'‚Äî')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">State</span><span>${escHtml(c.state||'‚Äî')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Address</span><span>${escHtml(c.address||'‚Äî')}</span></div>
    <h4 style="font-family:'Playfair Display',serif;margin:16px 0 12px;color:var(--gold-bright);">Order Info</h4>
    <div class="order-detail-row"><span class="order-detail-label">Ref</span><span style="font-family:monospace;font-size:12px;">${escHtml(o.txRef||'‚Äî')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Flutterwave ID</span><span style="font-family:monospace;font-size:12px;">${escHtml(String(o.flutterwaveId||'‚Äî'))}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Shipping Method</span><span>${escHtml(o.shippingMethod||'Standard')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Referral Code</span><span>${escHtml(o.referralCode||'‚Äî')}</span></div>
    <div class="order-detail-row"><span class="order-detail-label">Order Date</span><span>${date}</span></div>
    <div class="order-detail-row">
      <span class="order-detail-label">üí≥ Payment Status</span>
      <span class="badge badge-teal">${payStatus}</span>
    </div>
    <div class="order-detail-row">
      <span class="order-detail-label">üì¶ Fulfillment Status</span>
      <select class="status-select" onchange="updateOrderStatus('${escAttr(o._id)}',this.value)">
        <option value="processing"${fulfillStatus==='processing'?' selected':''}>‚öôÔ∏è Processing</option>
        <option value="shipped"${fulfillStatus==='shipped'?' selected':''}>üö¢ Shipped</option>
        <option value="delivered"${fulfillStatus==='delivered'?' selected':''}>‚úÖ Delivered</option>
      </select>
    </div>
    <h4 style="font-family:'Playfair Display',serif;margin:16px 0 12px;color:var(--gold-bright);">Items</h4>
    <table class="order-items-table">
      <thead><tr><th>Item</th><th>Variant</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
      <tbody>
        ${items.map(it=>`<tr>
          <td>${escHtml(it.name||'‚Äî')}</td>
          <td>${escHtml(it.variant||'‚Äî')}</td>
          <td>${it.qty||1}</td>
          <td>‚Ç¶${(it.price||0).toLocaleString()}</td>
          <td>‚Ç¶${((it.price||0)*(it.qty||1)).toLocaleString()}</td>
        </tr>`).join('')}
      </tbody>
    </table>
    <div class="order-detail-row" style="margin-top:12px;font-weight:700;">
      <span style="color:var(--gold-bright);">Total Paid</span>
      <span style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--gold-bright);">‚Ç¶${(o.totalPaid||0).toLocaleString()}</span>
    </div>
  `;
  document.getElementById('order-modal').classList.add('open');
};

window.closeOrderModal = function(){ document.getElementById('order-modal').classList.remove('open'); currentOrderDoc=null; };

window.openWhatsApp = function(){
  if(!currentOrderDoc) return;
  buildWhatsApp(currentOrderDoc);
};
window.openWhatsAppDirect = function(id){
  const o = allOrders.find(x=>x._id===id);
  if(o) buildWhatsApp(o);
};
function buildWhatsApp(o){
  const c=o.customer||{};
  const phone=(c.phone||'').replace(/[^0-9]/g,'');
  const fulfillStatus=o.orderStatus||'processing';
  const items=(o.items||[]).map(i=>`‚Ä¢ ${i.name} √ó${i.qty} (${i.variant||'Standard'}) = ‚Ç¶${((i.price||0)*(i.qty||1)).toLocaleString()}`).join('\n');
  const msg=encodeURIComponent(
    `Hello ${c.firstName||'Customer'} üëã\n\nYour GGS Global Consult order update:\n\n` +
    `üìã Ref: ${o.txRef||'N/A'}\n` +
    `üí≥ Payment: ${o.status||'paid'} ‚úÖ\n` +
    `üì¶ Fulfillment: ${fulfillStatus}\n` +
    `üöö Shipping: ${o.shippingMethod||'Standard'}\n\n` +
    `Items:\n${items}\n\n` +
    `üí∞ Total Paid: ‚Ç¶${(o.totalPaid||0).toLocaleString()}\n\n` +
    `Thank you for shopping with GGS Global Consult! üõçÔ∏è`
  );
  window.open(`https://wa.me/${phone}?text=${msg}`,'_blank');
}

window.exportOrdersCSV = function(){
  const rows=[['Ref','Flutterwave ID','Name','Email','Phone','State','Address','Items','Total (‚Ç¶)','Shipping Method','Payment Status','Fulfillment Status','Referral Code','Date']];
  allOrders.forEach(o=>{
    const c=o.customer||{};
    const date=o.createdAt?.toDate?o.createdAt.toDate().toLocaleDateString('en-NG'):'';
    const itemsSummary=(o.items||[]).map(i=>`${i.name}√ó${i.qty}(${i.variant||''})`).join(' | ');
    rows.push([
      o.txRef||'',
      String(o.flutterwaveId||''),
      `${c.firstName||''} ${c.lastName||''}`.trim(),
      c.email||'',
      c.phone||'',
      c.state||'',
      c.address||'',
      itemsSummary,
      o.totalPaid||0,
      o.shippingMethod||'',
      o.status||'',
      o.orderStatus||'',
      o.referralCode||'',
      date
    ]);
  });
  const csv=rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`ggs-orders-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  showToast('CSV exported!','success');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê CATEGORIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.renderCategoryGrid = function(){
  const cats = [...new Set(allProducts.map(p=>p.category).filter(Boolean))].sort();
  const grid = document.getElementById('cat-grid');
  if(!cats.length){
    grid.innerHTML=`<div class="empty-state"><div class="empty-state-icon">üè∑Ô∏è</div><h3>No categories yet</h3><p>Add products to see categories here.</p></div>`;
    return;
  }
  grid.innerHTML=cats.map(c=>{
    const meta=CAT_META[c];
    const total=allProducts.filter(p=>p.category===c).length;
    const active=allProducts.filter(p=>p.category===c&&p.active!==false).length;
    const hidden=total-active;
    return `<div class="cat-chip">
      <div class="cat-chip-icon">${meta?meta.icon:'üì¶'}</div>
      <div class="cat-chip-label">${escHtml(meta?meta.label:c)}</div>
      <div class="cat-chip-key">${escHtml(c)}</div>
      <div class="cat-chip-stats">
        <div class="cat-stat"><span>${total}</span> total</div>
        <div class="cat-stat"><span>${active}</span> active</div>
        <div class="cat-stat"><span>${hidden}</span> hidden</div>
      </div>
      <button class="btn btn-outline btn-sm" style="width:100%;" onclick="switchPanel('products',document.querySelector('[data-panel=products]'));filterProducts('${escAttr(c)}',null);document.querySelector('[data-cat=\\'${escAttr(c)}\\']')&&document.querySelector('[data-cat=\\'${escAttr(c)}\\']').classList.add('active')">View Products</button>
    </div>`;
  }).join('');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function populateSettings(s){
  if(s.announcementText!==undefined) document.getElementById('s-announcement').value=s.announcementText;
  if(s.countdownDeadline){
    try{
      const d=s.countdownDeadline.toDate?s.countdownDeadline.toDate():new Date(s.countdownDeadline);
      document.getElementById('s-countdown').value=d.toISOString().slice(0,16);
    }catch(e){}
  }
  if(s.urgencySlots){
    document.getElementById('s-slots-total').value=s.urgencySlots.total||'';
    document.getElementById('s-slots-remaining').value=s.urgencySlots.remaining||'';
  }
  if(s.currentRound!==undefined) document.getElementById('s-round').value=s.currentRound;
  if(s.deliveryFeePH!==undefined) document.getElementById('s-fee-ph').value=s.deliveryFeePH;
if(s.deliveryFeeOther!==undefined) document.getElementById('s-fee-other').value=s.deliveryFeeOther;
if(s.deliveryFeeLagos!==undefined) document.getElementById('s-fee-lagos').value=s.deliveryFeeLagos;
if(s.deliveryFeeNorth!==undefined) document.getElementById('s-fee-north').value=s.deliveryFeeNorth;
  if(s.whatsappNumber!==undefined) document.getElementById('s-whatsapp').value=s.whatsappNumber;
  document.getElementById('s-maintenance').checked=!!s.maintenanceMode;
  document.getElementById('s-accepting').checked=s.acceptingOrders!==false;
  if(s.agentSection){
document.getElementById('s-agent-commission').value = s.agentSection.commission || 5;
document.getElementById('s-agent-min-order').value = s.agentSection.minOrder || 200000;
document.getElementById('s-agent-ex1-orders').value = s.agentSection.ex1Orders || 2;
document.getElementById('s-agent-avg-order').value = s.agentSection.avgOrder || 500000;
document.getElementById('s-agent-visible').checked = s.agentSection.visible !== false;
}
  if(s.referralTiers){
    document.getElementById('s-tier-bronze').value=s.referralTiers.bronze||1;
    document.getElementById('s-tier-silver').value=s.referralTiers.silver||3;
    document.getElementById('s-tier-gold').value=s.referralTiers.gold||5;
    document.getElementById('s-tier-platinum').value=s.referralTiers.platinum||10;
    tierSettings=s.referralTiers;
  }
}

window.saveSettings = async function(){
  const cd=document.getElementById('s-countdown').value;
  let countdown=null;
  if(cd){ try{ countdown=Timestamp.fromDate(new Date(cd)); }catch(e){} }
  const data={
    announcementText:document.getElementById('s-announcement').value.trim(),
    countdownDeadline:countdown,
    urgencySlots:{
      total:parseInt(document.getElementById('s-slots-total').value)||0,
      remaining:parseInt(document.getElementById('s-slots-remaining').value)||0,
    },
    currentRound:document.getElementById('s-round').value.trim(),
    deliveryFeePH:parseInt(document.getElementById('s-fee-ph').value)||0,
deliveryFeeOther:parseInt(document.getElementById('s-fee-other').value)||0,
deliveryFeeLagos:parseInt(document.getElementById('s-fee-lagos').value)||0,
deliveryFeeNorth:parseInt(document.getElementById('s-fee-north').value)||0,
    whatsappNumber:document.getElementById('s-whatsapp').value.trim(),
    maintenanceMode:document.getElementById('s-maintenance').checked,
    acceptingOrders:document.getElementById('s-accepting').checked,
    agentSection:{
commission: parseInt(document.getElementById('s-agent-commission').value) || 5,
minOrder: parseInt(document.getElementById('s-agent-min-order').value) || 200000,
ex1Orders: parseInt(document.getElementById('s-agent-ex1-orders').value) || 2,
avgOrder: parseInt(document.getElementById('s-agent-avg-order').value) || 500000,
visible: document.getElementById('s-agent-visible').checked,
},
    referralTiers:{
      bronze:parseInt(document.getElementById('s-tier-bronze').value)||1,
      silver:parseInt(document.getElementById('s-tier-silver').value)||3,
      gold:parseInt(document.getElementById('s-tier-gold').value)||5,
      platinum:parseInt(document.getElementById('s-tier-platinum').value)||10,
    },
    updatedAt:serverTimestamp(),
  };
  try{
    await setDoc(doc(db,'settings','site-config'),data,{merge:true});
    showToast('Settings saved!','success');
  }catch(e){ showToast('Error saving settings: '+e.message,'error'); }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê REFERRALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.renderReferrals = function(){
  const q=(document.getElementById('referral-search').value||'').toLowerCase();
  const grouped={};
  allOrders.forEach(o=>{
    const code=o.referralCode||'';
    if(!code) return;
    if(!grouped[code]) grouped[code]={code,count:0,total:0};
    grouped[code].count++;
    grouped[code].total+=(o.totalPaid||0);
  });
  let rows=Object.values(grouped);
  if(q) rows=rows.filter(r=>r.code.toLowerCase().includes(q));
  rows.sort((a,b)=>b.count-a.count);
  const tbody=document.getElementById('referrals-tbody');
  if(!rows.length){
    tbody.innerHTML=`<tr><td colspan="4"><div class="empty-state"><div class="empty-state-icon">üéÅ</div><h3>No referrals yet</h3><p>Orders with referral codes will appear here.</p></div></td></tr>`;
    return;
  }
  tbody.innerHTML=rows.map(r=>{
    const t=tierSettings;
    let tier='‚Äî',tierClass='';
    if(r.count>=(t.platinum||10)){ tier='üíé Platinum'; tierClass='tier-platinum'; }
    else if(r.count>=(t.gold||5)){ tier='ü•á Gold'; tierClass='tier-gold'; }
    else if(r.count>=(t.silver||3)){ tier='ü•à Silver'; tierClass='tier-silver'; }
    else if(r.count>=(t.bronze||1)){ tier='ü•â Bronze'; tierClass='tier-bronze'; }
    return `<tr>
      <td style="font-family:monospace;">${escHtml(r.code)}</td>
      <td>${r.count}</td>
      <td style="font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--gold-bright);">‚Ç¶${r.total.toLocaleString()}</td>
      <td><span class="${tierClass}" style="font-weight:700;">${tier}</span></td>
    </tr>`;
  }).join('');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê SEEDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEED_PRODUCTS = [
  {id:'seed-tech-001',name:'iPhone 15 Pro Max',price:895000,category:'tech',icon:'üì±',spec:'256GB, Titanium, 6.7" OLED',variants:['Black Titanium','White Titanium','Blue Titanium'],badge:'hot',badgeText:'Best Seller',img:'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400',active:true,sortOrder:1},
  {id:'seed-tech-002',name:'Samsung Galaxy S24 Ultra',price:750000,category:'tech',icon:'üì±',spec:'512GB, Titanium Gray, 6.8" QHD+',variants:['Titanium Gray','Titanium Black','Titanium Violet'],badge:'new',badgeText:'New Arrival',img:'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=400',active:true,sortOrder:2},
  {id:'seed-tech-003',name:'AirPods Pro 2nd Gen',price:185000,category:'tech',icon:'üéß',spec:'Active Noise Cancellation, H2 Chip',variants:['White'],badge:'pick',badgeText:'Top Pick',img:'https://images.unsplash.com/photo-1600294037681-c80b4cb5b434?w=400',active:true,sortOrder:3},
  {id:'seed-tech-004',name:'MacBook Air M3',price:1250000,category:'tech',icon:'üíª',spec:'8GB RAM, 256GB SSD, 13.6" Liquid Retina',variants:['Midnight','Starlight','Space Gray','Silver'],badge:'',badgeText:'',img:'https://images.unsplash.com/photo-1611186871525-1b13a9f4e99f?w=400',active:true,sortOrder:4},
  {id:'seed-tech-005',name:'iPad Pro 12.9" M4',price:980000,category:'tech',icon:'üìü',spec:'256GB, WiFi, Ultra Retina XDR',variants:['Space Black','Silver'],badge:'hot',badgeText:'Limited Stock',img:'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400',active:true,sortOrder:5},
  {id:'seed-tech-006',name:'Sony WH-1000XM5',price:145000,category:'tech',icon:'üéß',spec:'Industry-leading ANC, 30hr battery',variants:['Black','Platinum Silver'],badge:'',badgeText:'',img:'https://images.unsplash.com/photo-1585386959984-a4155224a1ad?w=400',active:true,sortOrder:6},
  {id:'seed-tech-007',name:'DJI Mini 4 Pro Drone',price:520000,category:'tech',icon:'üöÅ',spec:'4K/60fps, 34 min flight, 20km range',variants:['Standard','Fly More Combo'],badge:'new',badgeText:'Just Landed',img:'https://images.unsplash.com/photo-1507582020474-9a35b7d455d9?w=400',active:true,sortOrder:7},
  {id:'seed-tech-008',name:'Apple Watch Series 9',price:295000,category:'tech',icon:'‚åö',spec:'45mm, Always-On Retina, GPS+Cellular',variants:['Midnight','Starlight','Pink','(Product)Red'],badge:'pick',badgeText:'Staff Pick',img:'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400',active:true,sortOrder:8},
  {id:'seed-fashion-001',name:'Nike Air Max 270',price:78000,category:'shoes',icon:'üëü',spec:'React foam, Air Max unit, Breathable mesh',variants:['UK 7','UK 8','UK 9','UK 10','UK 11'],badge:'hot',badgeText:'Trending',img:'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400',active:true,sortOrder:9},
  {id:'seed-fashion-002',name:'Luxury Leather Handbag',price:125000,category:'bags',icon:'üëú',spec:'Genuine leather, Gold hardware, Multiple pockets',variants:['Black','Brown','Cream','Red'],badge:'pick',badgeText:'Premium',img:'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=400',active:true,sortOrder:10},
  {id:'seed-fashion-003',name:'Men\'s Automatic Watch',price:185000,category:'watches',icon:'‚åö',spec:'Stainless steel, Sapphire crystal, 50m WR',variants:['Silver/Black','Gold/Brown','Rose Gold'],badge:'',badgeText:'',img:'https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=400',active:true,sortOrder:11},
  {id:'seed-fashion-004',name:'Chanel No.5 Perfume 100ml',price:195000,category:'perfume',icon:'üå∏',spec:'Eau de Parfum, Floral-Aldehyde, 100ml',variants:['100ml EDP'],badge:'hot',badgeText:'Signature',img:'https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=400',active:true,sortOrder:12},
  {id:'seed-fashion-005',name:'Premium Gold Necklace',price:65000,category:'jewelry',icon:'üíç',spec:'18K gold plated, Cuban chain, 22 inches',variants:['22 inch','24 inch'],badge:'new',badgeText:'New In',img:'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400',active:true,sortOrder:13},
  {id:'seed-fashion-006',name:'Adidas Track Suit Set',price:55000,category:'fashion',icon:'üëó',spec:'3-Stripe design, Polyester, Slim fit',variants:['S','M','L','XL','XXL'],badge:'',badgeText:'',img:'https://images.unsplash.com/photo-1512374382149-233c42b6a83b?w=400',active:true,sortOrder:14},
];

window.runSeeder = async function(){
  const output = document.getElementById('seed-output');
  output.innerHTML='<span class="spinner"></span> Seeding products‚Ä¶';
  let success=0,errors=0;
  for(const p of SEED_PRODUCTS){
    const {id,...data} = p;
    try{
      await setDoc(doc(db,'products',id),{...data,createdAt:serverTimestamp(),updatedAt:serverTimestamp()});
      success++;
      output.innerHTML=`<span class="spinner"></span> Seeded ${success}/${SEED_PRODUCTS.length}‚Ä¶`;
    }catch(e){ errors++; console.error(e); }
  }
  output.innerHTML=`‚úÖ Done! ${success} products seeded${errors?`, ${errors} errors ‚Äî check console.`:'.'}`;;
  showToast(`Seeded ${success} products!`,'success');
};

// ‚îÄ‚îÄ KEY BINDINGS ‚îÄ‚îÄ
document.getElementById('login-pass').addEventListener('keydown',e=>{ if(e.key==='Enter') doLogin(); });
document.getElementById('login-email').addEventListener('keydown',e=>{ if(e.key==='Enter') document.getElementById('login-pass').focus(); });

</script>
</body>
</html>